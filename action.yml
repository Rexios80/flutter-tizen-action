name: 'Build flutter-tizen tpk'
description: 'Build flutter-tizen tpk'
inputs:
  project-root:
    description: 'The root of your flutter-tizen project'
    required: false
    default: $GITHUB_WORKSPACE
  tizen-studio-version:
    description: 'Tizen Studio version (default 4.1)'
    required: false
    default: '4.1'
  tizen-platform:
    description: 'The api level your app'
    required: false
    default: 'WEARABLE-5.5'
  certificate-file:
    description: 'Signing certificate file'
    required: true
  certificate-password:
    description: 'Signing certificate password'
    required: true
runs:
  using: "composite"
  steps:
    - run: |
        sudo apt update
        sudo apt install libpython2.7
      shell: bash

    - run: |
        curl http://download.tizen.org/sdk/Installer/tizen-studio_${{ inputs.tizen-studio-version }}/web-cli_Tizen_Studio_${{ inputs.tizen-studio-version }}_ubuntu-64.bin > tizen-studio.bin
        chmod 755 tizen-studio.bin
        mkdir tizen-studio
        ./tizen-studio.bin --no-java-check --accept-license $GITHUB_WORKSPACE/tizen-studio
        rm tizen-studio.bin
      shell: bash

    - run: |
        export PATH=$GITHUB_WORKSPACE/tizen-studio/tools:$GITHUB_WORKSPACE/tizen-studio/tools/ide/bin:$PATH
        tizen security-profiles add -n ActionsProfile -a ${{ inputs.certificate-file }} -p "${{ inputs.certificate-password }}"
        tizen cli-config "profiles.path=$GITHUB_WORKSPACE/tizen-studio-data/profile/profiles.xml"
      shell: bash

    - run: |
        mkdir flutter-tizen
        git clone https://github.com/flutter-tizen/flutter-tizen.git flutter-tizen
      shell: bash

    - run: |
        export PATH=$GITHUB_WORKSPACE/tizen-studio/tools:$GITHUB_WORKSPACE/tizen-studio/tools/ide/bin:$PATH
        export PATH=$GITHUB_WORKSPACE/tizen-studio/package-manager:$PATH
        export PATH=$GITHUB_WORKSPACE/flutter-tizen/bin:$PATH
        package-manager-cli.bin install TOOLS
        package-manager-cli.bin install ${{ inputs.tizen-platform }}-NativeAppDevelopment-CLI
        flutter-tizen doctor -v
        flutter-tizen pub get
        flutter-tizen build tpk
      shell: bash
